<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2048 ‚Äì WebArcade</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:system-ui}
:root{--bg1:#020617;--bg2:#1e293b;--text:#776e65}
body{
  min-height:100vh;
  background:
    radial-gradient(circle at 20% 20%,rgba(99,102,241,.25),transparent 40%),
    radial-gradient(circle at 80% 80%,rgba(34,197,94,.25),transparent 40%),
    linear-gradient(135deg,var(--bg1),var(--bg2));
  display:flex;
  justify-content:center;
  align-items:center;
  padding:20px
}
.scene{
  display:flex;
  gap:24px;
  padding:32px;
  border-radius:26px;
  backdrop-filter:blur(16px);
  background:rgba(255,255,255,.08);
  box-shadow:0 40px 120px rgba(0,0,0,.45)
}
@media(max-width:900px){
  .scene{flex-direction:column}
}
.top-bar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:14px
}
.back-btn{background:none;border:none;color:var(--text);cursor:pointer}
.title{font-size:30px;font-weight:800;color:var(--text)}
.score-box{display:flex;gap:8px}
.score,.best{
  background:#bbada0;color:#fff;
  padding:8px 12px;border-radius:6px;font-weight:bold
}
.board{
  background:#bbada0;
  padding:12px;
  border-radius:12px;
  display:grid;
  grid-template-columns:repeat(4,80px);
  gap:10px
}
.cell{
  width:80px;height:80px;background:#cdc1b4;
  border-radius:6px;
  display:flex;align-items:center;justify-content:center;
  font-size:28px;font-weight:bold;color:#776e65
}
.cell[data-value="2"]{background:#eee4da}
.cell[data-value="4"]{background:#ede0c8}
.cell[data-value="8"]{background:#f2b179;color:#fff}
.cell[data-value="16"]{background:#f59563;color:#fff}
.cell[data-value="32"]{background:#f67c5f;color:#fff}
.cell[data-value="64"]{background:#f65e3b;color:#fff}
.cell[data-value="128"]{background:#edcf72;color:#fff}
.cell[data-value="256"]{background:#edcc61;color:#fff}
.cell[data-value="512"]{background:#edc850;color:#fff}
.cell[data-value="1024"]{background:#edc53f;color:#fff}
.cell[data-value="2048"]{background:#edc22e;color:#fff}

/* LEADERBOARD */
.leaderboard{
  min-width:220px;
  background:rgba(255,255,255,.15);
  border-radius:16px;
  padding:16px
}
.leaderboard h3{
  margin-bottom:10px;
  color:#fff
}
.entry{
  display:flex;
  justify-content:space-between;
  padding:6px 0;
  font-size:14px;
  color:#f1f5f9
}
.rank{opacity:.7}
</style>
</head>

<body>

<div class="scene">

  <!-- GAME -->
  <div>
    <div class="top-bar">
      <button class="back-btn" onclick="location.href='blog.html'">‚Üê Back</button>
      <div class="title">2048</div>
      <div class="score-box">
        <div class="score" id="score">0</div>
        <div class="best" id="best">Best: 0</div>
      </div>
    </div>
    <div class="board" id="board"></div>
  </div>

  <!-- LEADERBOARD -->
  <div class="leaderboard">
    <h3>üèÜ Leaderboard</h3>
    <div id="leaderboard"></div>
  </div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
import {
  getFirestore, collection, query, orderBy, limit, getDocs, doc, setDoc
} from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

const app=initializeApp({
  apiKey:"AIzaSyCzomf89xZhgcPsfYXKsYspCt-CiUVzjBA",
  authDomain:"webarcade-d4c3d.firebaseapp.com",
  projectId:"webarcade-d4c3d"
});
const auth=getAuth(app);
const db=getFirestore(app);
let user=null;

onAuthStateChanged(auth,u=>user=u);

const boardEl=document.getElementById("board");
const scoreEl=document.getElementById("score");
const bestEl=document.getElementById("best");
const leaderboardEl=document.getElementById("leaderboard");

let board,score;
let best=Number(localStorage.getItem("best2048")||0);

async function loadLeaderboard(){
  leaderboardEl.innerHTML="";
  const q=query(collection(db,"users"),orderBy("bestScore","desc"),limit(5));
  const snap=await getDocs(q);
  let rank=1;
  snap.forEach(d=>{
    const data=d.data();
    if(!data.bestScore||!data.username) return;
    leaderboardEl.innerHTML+=`
      <div class="entry">
        <span class="rank">#${rank++} ${data.username}</span>
        <span>${data.bestScore}</span>
      </div>`;
  });
}

function init(){
  board=Array.from({length:4},()=>Array(4).fill(0));
  score=0;
  addRandom();addRandom();
  draw();
  loadLeaderboard();
}
function draw(){
  boardEl.innerHTML="";
  board.flat().forEach(v=>{
    const c=document.createElement("div");
    c.className="cell";
    if(v){c.textContent=v;c.dataset.value=v}
    boardEl.appendChild(c);
  });
  scoreEl.textContent=score;
  bestEl.textContent="Best: "+best;
}
function addRandom(){
  const e=[];
  board.forEach((r,i)=>r.forEach((v,j)=>!v&&e.push([i,j])));
  if(!e.length)return;
  const[x,y]=e[Math.floor(Math.random()*e.length)];
  board[x][y]=Math.random()<.9?2:4;
}
function slide(r){
  r=r.filter(v=>v);
  for(let i=0;i<r.length-1;i++){
    if(r[i]===r[i+1]){
      r[i]*=2;score+=r[i];r[i+1]=0;
    }
  }
  return r.filter(v=>v).concat([0,0,0,0]).slice(0,4);
}
function move(d){
  const old=JSON.stringify(board);
  if(d==="left")board=board.map(r=>slide(r));
  if(d==="right")board=board.map(r=>slide(r.reverse()).reverse());
  if(d==="up")for(let c=0;c<4;c++){
    const col=slide(board.map(r=>r[c]));
    for(let r=0;r<4;r++)board[r][c]=col[r];
  }
  if(d==="down")for(let c=0;c<4;c++){
    const col=slide(board.map(r=>r[c]).reverse()).reverse();
    for(let r=0;r<4;r++)board[r][c]=col[r];
  }
  if(JSON.stringify(board)!==old){
    addRandom();draw();
    if(score>best){
      best=score;
      localStorage.setItem("best2048",best);
      if(user){
        setDoc(doc(db,"users",user.uid),{
          username:user.displayName||"Player",
          bestScore:Number(best)
        },{merge:true}).then(loadLeaderboard);
      }
    }
  }
}

document.addEventListener("keydown",e=>{
  if(e.key==="ArrowLeft")move("left");
  if(e.key==="ArrowRight")move("right");
  if(e.key==="ArrowUp")move("up");
  if(e.key==="ArrowDown")move("down");
});

init();
</script>

</body>
</html>
